from pe_parser.asm_parser import AssemblyParser
import os
import time
import pandas as pd
directory = 'mal'
i=0
for filename in os.listdir(directory):
    if filename.endswith('.asm'):
        f = os.path.join(directory, filename)
        if os.path.isfile(f):
            asm_parser = AssemblyParser(f)
            metadata_features = asm_parser.extract_asm_metadata_features()

            symbol_features = asm_parser.extract_symbol_features()

            opcode_features = asm_parser.extract_opcode_unigram_features()

            register_features = asm_parser.extract_register_features()

            # api_features = asm_parser.extract_API_features()

            misc_features = asm_parser.extract_MISC_features()

            section_features = asm_parser.extract_section_features()

            data_define_features = asm_parser.extract_data_define_features()

            df1 = pd.DataFrame([metadata_features])
            df2 = pd.DataFrame([symbol_features])
            df3 = pd.DataFrame([opcode_features])
            df4 = pd.DataFrame([register_features])
            # df5 = pd.DataFrame([api_features])
            df6 = pd.DataFrame([misc_features])
            df7 = pd.DataFrame([section_features])
            df8 = pd.DataFrame([data_define_features])
            if(i==0):
                df = pd.concat([df1, df2, df3, df4, df6, df7, df8], axis=1)
                f = f[13:]
                f = f[:len(f)-4]
                df['malwareFile'] = [f]

            else:
                mid_df = pd.concat([df1, df2, df3, df4, df6, df7, df8], axis=1)
                f = f[13:]
                f = f[:len(f)-4]
                mid_df['malwareFile'] = [f]
                df = pd.concat([df, mid_df], ignore_index=True)
            i=i+1
            print(i,end='\r')
            time.sleep(.5)
print("The dataframe is: \n\n\n")
print(df)
df.to_csv('df.csv')       
         
